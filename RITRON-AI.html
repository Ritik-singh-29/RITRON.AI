<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RITRON</title>
    <!-- Include Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 800px;
        }
        /* Custom styles for a more attractive UI */
        .shadow-glow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
        }
        .shadow-glow:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center min-h-screen p-4">
    <div class="container bg-white p-8 rounded-3xl shadow-glow border border-gray-200">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2 text-center">RITRON</h1>
        <p class="text-sm text-gray-500 mb-6 text-center">Your AI companion for creative tasks.</p>

        <!-- Form for user input -->
        <form id="text-form" class="space-y-6">
            <div>
                <label for="prompt" class="block text-lg font-semibold text-gray-700">Enter your prompt:</label>
                <textarea id="prompt" rows="5" class="mt-2 block w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-base p-4 border" placeholder="Hi, I’m Ritron. Let’s solve, explore & learn together."></textarea>
            </div>
            <div>
                <label for="tone-select" class="block text-lg font-semibold text-gray-700">Select Tone:</label>
                <select id="tone-select" class="mt-2 block w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-base p-2 border">
                    <option value="default">Default</option>
                    <option value="professional">Professional</option>
                    <option value="casual">Casual</option>
                    <option value="witty">Witty</option>
                    <option value="friendly">Friendly</option>
                </select>
            </div>
            <div>
                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-xl shadow-lg text-base font-medium text-white bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transform hover:scale-105 transition-transform">
                    Generate Text
                </button>
            </div>
        </form>

        <!-- Loading indicator and output area -->
        <div id="loading" class="hidden mt-8 text-center text-gray-600">
            <svg class="animate-spin h-8 w-8 text-purple-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-3 text-lg font-medium">Generating content...</p>
        </div>

        <div id="output" class="mt-8 p-6 bg-gray-50 rounded-xl border border-gray-200 hidden">
            <h3 class="text-2xl font-semibold mb-3 text-gray-800">Generated Text</h3>
            <div id="output-content" class="whitespace-pre-wrap text-gray-700 text-base leading-relaxed"></div>
        </div>

        <!-- Custom message box for errors -->
        <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
                <h4 class="text-lg font-bold mb-2">Error</h4>
                <p id="message-content" class="text-sm text-gray-700"></p>
                <button onclick="document.getElementById('message-box').classList.add('hidden')" class="mt-4 w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700">
                    Close
                </button>
            </div>
        </div>

        <div class="mt-8 text-sm text-gray-500 text-center">
            Developed by Ritik
        </div>
    </div>
    
    <script>
        // Use a function to show a custom message box instead of alert()
        function showMessage(title, message) {
            const messageBox = document.getElementById('message-box');
            const messageContent = document.getElementById('message-content');
            
            messageContent.textContent = message;
            messageBox.classList.remove('hidden');
        }

        const form = document.getElementById('text-form');
        const promptInput = document.getElementById('prompt');
        const toneSelect = document.getElementById('tone-select');
        const loadingIndicator = document.getElementById('loading');
        const outputDiv = document.getElementById('output');
        const outputContent = document.getElementById('output-content');
        
        // Define the API URL and key as per instructions
        const apiKey = "AIzaSyD4i1PQh76B_03jYAqE9F3kkX77pBZzQxM";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const prompt = promptInput.value.trim();
            const tone = toneSelect.value;
            if (!prompt) {
                showMessage('Warning', 'Please enter a prompt.');
                return;
            }

            // Show loading indicator and hide output
            loadingIndicator.classList.remove('hidden');
            outputDiv.classList.add('hidden');
            
            // Fetch and process the response
            try {
                // Prepare the request payload with tone
                const fullPrompt = tone === 'default' ? prompt : `Generate text in a ${tone} tone: ${prompt}`;
                const payload = {
                    contents: [
                        {
                            role: "user",
                            parts: [{ text: fullPrompt }]
                        }
                    ]
                };

                let response;
                let retries = 0;
                const maxRetries = 5;
                const baseDelay = 1000; // 1 second

                while (retries < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (response.ok) {
                            break; // Success, exit the retry loop
                        } else if (response.status === 429) {
                            // Too many requests, retry with exponential backoff
                            const delay = baseDelay * Math.pow(2, retries);
                            console.log(`Rate limited. Retrying in ${delay / 1000} seconds...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            retries++;
                        } else {
                            // Other errors, throw to be caught below
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        if (retries === maxRetries - 1) {
                            // Last retry, re-throw the error
                            throw error;
                        }
                        retries++;
                    }
                }

                if (!response || !response.ok) {
                    throw new Error('Failed to fetch after multiple retries.');
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const text = result.candidates[0].content.parts[0].text;
                    outputContent.textContent = text;
                    outputDiv.classList.remove('hidden');

                } else {
                    // Handle cases where the response structure is unexpected or content is missing
                    showMessage('Error', 'Unexpected API response format or no content found.');
                }

            } catch (error) {
                console.error('Error during fetch:', error);
                showMessage('Error', 'An error occurred while fetching the response. Please check your network connection and try again.');
            } finally {
                // Hide loading indicator
                loadingIndicator.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
